# RealTimeChat ì„œë¹„ìŠ¤

<br>

> <b style="color:#555555">í”„ë¡œì íŠ¸ ê¸°ê°„ : 2025.01.08 ~ 2025.01.29</b>
## í”„ë¡œì íŠ¸ ê°œìš” ë° ê¸°íš ì˜ë„
ë³¸ í”„ë¡œì íŠ¸ëŠ” WebSocketì„ í™œìš©í•œ ì‹¤ì‹œê°„ ìµëª… ì±„íŒ… ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. <br/>
ê¸°ì¡´ HTTPì˜ ë¬´ìƒíƒœì„±(Stateless) ë° ë¹„ì—°ê²°ì„±(Connectionless)ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê³ , ì–‘ë°©í–¥ í†µì‹ ì„ ì§€ì›í•˜ëŠ” WebSocketì„ í•™ìŠµí•˜ë©° êµ¬í˜„í•˜ëŠ” ê²ƒì´ ëª©í‘œì˜€ìŠµë‹ˆë‹¤. <br/>
STOMP í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ ë¹„ë™ê¸° ë©”ì‹œì§• êµ¬ì¡°ë¥¼ ì„¤ê³„í•˜ì˜€ìœ¼ë©°, ì„œë²„ ë¶€ë‹´ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ JWT ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦ì„ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ ì—†ì´ ì„œë¹„ìŠ¤ì— ì ‘ì†í•  ìˆ˜ ìˆìœ¼ë©°, ìµœì´ˆ ì ‘ì† ì‹œ ëœë¤ ë‹‰ë„¤ì„ê³¼ ê³ ìœ  ë„¤ì„ íƒœê·¸ë¥¼ í¬í•¨í•œ JWT í† í°ì„ ë°œê¸‰ë°›ì•„ ë³¸ì¸ì„ ì‹ë³„í•©ë‹ˆë‹¤. <br/>
ì´ëŸ¬í•œ êµ¬ì¡°ë¥¼ í†µí•´ ë³„ë„ì˜ ì„œë²„ ì„¸ì…˜ ê´€ë¦¬ ì—†ì´ë„ ì•ˆì •ì ì¸ ì‹¤ì‹œê°„ ì±„íŒ… í™˜ê²½ì„ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, ë©”ì‹œì§• êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜í‰ì  í™•ì¥ì„±ì„ ê³ ë ¤í•œ ì„¤ê³„ë¥¼ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

<br><br/>

## **Stacks**

#### **Environment**

<div style='display:flex;margin-bottom:20px'>
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/VScode-007ACC?style=for-the-badge&logo=visualstudio&logoColor=white">
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/intelliJ-000000?style=for-the-badge&logo=intellijidea&logoColor=white">
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/GIT-F05032?style=for-the-badge&logo=git&logoColor=white">
<img  style="margin:0 5px 0 0"src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white">
</div>

#### **Development**

<div style='display:flex;margin-bottom:20px'>
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/java-007396?style=for-the-badge&logoColor=white">
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/javaScript-3178c6?style=for-the-badge&logo=javascript&logoColor=white">
<img style="margin:0 5px 0 0"src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
<img style="margin:0 5px 0 0"src="https://img.shields.io/badge/springSecurity-6DB33F?style=for-the-badge&logo=springSecurity&logoColor=white">
<img style="margin:0 5px 0 0"src="https://img.shields.io/badge/jwt-8000FF?style=for-the-badge&logo=jwt&logoColor=white">
<img style="margin:0 5px 0 0"src="https://img.shields.io/badge/STOMP/WS-424242?style=for-the-badge&logo=STOMP/WS&logoColor=white">
<img style="margin:0 5px 0 0"src="https://img.shields.io/badge/JPA-04B431?style=for-the-badge&logo=hibernate&logoColor=white">
</div>

#### **Comunication**
<div style='display:flex;margin-bottom:20px'>
<img style="margin:0 5px 0 0" src="https://img.shields.io/badge/NOTION-000000?style=for-the-badge&logo=notion&logoColor=white">
</div>

<br/><br/>



## ì£¼ìš” ê¸°ëŠ¥ ğŸ“¦

### 1. ìµëª… ê¸°ë°˜ ì‹¤ì‹œê°„ ì±„íŒ…
![chat](https://github.com/user-attachments/assets/de1d7948-0904-4b8e-a1ee-63d804ab78c3)
- JWT í† í°ì„ í™œìš©í•œ ì‚¬ìš©ì ì‹ ì› ë¶€ì—¬ ë° ì¸ì¦ [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/infra/security/JwtProvider.java#L36C1-L49C1)
  - ì‚¬ìš©ìê°€ ì¬ì ‘ì† ì‹œ JWTë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦í•˜ì—¬ ì„¸ì…˜ì´ ìƒˆë¡­ê²Œ ì‹œì‘ë˜ë”ë¼ë„ ì´ì „ì˜ ì±„íŒ… ê¸°ë¡ì„ ìë™ìœ¼ë¡œ ë¡œë”©í•˜ê³  ì‹ë³„í•  ìˆ˜ ìˆìŒ.
  
- Spring ë‚´ì¥ ë©”ì‹œì§• ë¸Œë¡œì»¤ì™€ STOMP í”„ë¡œí† ì½œì„ ì´ìš©í•˜ì—¬ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡ ë° ì ‘ì† ì¸ì› ê´€ë¦¬ (ì„¸ì…˜ ìˆ˜)
  - ë©”ì‹œì§• Broker [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/master/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/presentation/ChatWebSocketController.java)
  - ì ‘ì†ì ìˆ˜ Handler [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/infra/handler/StompListener.java#L10C1-L35C2)

- ë³„ë„ì˜ ë¡œê·¸ì¸/íšŒì›ê°€ì… ì—†ì´ ì¦‰ì‹œ ì„œë¹„ìŠ¤ ì‚¬ìš© ê°€ëŠ¥ (ìµëª… ì±„íŒ… ê¸°ë°˜)


<br/>

### 2. ìŠ¤í¬ë¡¤ ê¸°ë°˜ ë™ì  ë°ì´í„° ë¡œë”©
![loading](https://github.com/user-attachments/assets/8ecf1162-c946-48b7-b3c1-9fe187b5add6)
- ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„: ìŠ¤í¬ë¡¤ ìœ„ì¹˜ê°€ ìƒë‹¨ì— ë„ë‹¬í•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì¶”ê°€ ë°ì´í„°ë¥¼ ë¡œë”© [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Front-end/chat.js#L114C1-L147C6)
 
- ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê³ ì •: ë°ì´í„° ì¶”ê°€ ë¡œë”©ì‹œ ê¸°ì¡´ì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ í• ë‹¹ [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Front-end/chat.js#L170C1-L181C1)
 
- offset ~ limitì„ ì´ìš©í•œ ë™ì  ë°ì´í„° ìš”ì²­ì„ í†µí•´ í•„ìš”í•œ ë°ì´í„°ë§Œ ë¡œë“œí•˜ì—¬ íš¨ìœ¨ì  ì²˜ë¦¬ [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/infra/repository/springdatajpa/SpringDataJpaChatRepository.java#L10C1-L24C2) 



<br/><br/>

## ê¸°ëŠ¥ë³„ ì‹¤í–‰ íë¦„ë„ ğŸ“¦

### 1. HTTP to WebSocket Upgrade
![1-1-1](https://github.com/user-attachments/assets/517d4880-8d48-4c62-99fc-33fe42968a41)


1. **init()**: ìµœì´ˆ ì‚¬ìš©ìê°€ ì ‘ì†ì‹œ í† í° ìœ íš¨ì„±ê³¼ ë°œê¸‰ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ Serverë¡œ request ì „ì†¡ 
2. **WebSocket Upgrade ìš”ì²­**: HTTPì—ì„œ WebSocketìœ¼ë¡œ í”„ë¡œí† ì½œ ì—…ê·¸ë ˆì´ë“œ ìš”ì²­ì„ ì „ë‹¬

<br/><br/>


### 2. Spring Security 
![3-1](https://github.com/user-attachments/assets/656e5adf-fc65-41c6-a85c-50384de46885)

**[JWT ì—†ëŠ” ê²½ìš°]**
1. Headerì™€ í•¨ê»˜ Serverë¡œ Request ì „ì†¡
2. JwtAuthenticationFilterì— ì§„ì…
3. JwtProviderì—ì„œ ìƒˆ í† í°ì„ ìƒì„±
4. Clientë¡œ Response ì „ì†¡

<br/>

**[JWT ìˆëŠ” ê²½ìš°]**
1. Headerì™€ í•¨ê»˜ Serverë¡œ Request ì „ì†¡
2. JwtAuthenticationFilterì— ì§„ì…
3. ìš”ì²­ì„ AuthenticationManagerë¡œ ìœ„ì„
4. JwtAuthenticationProviderì™€ JwtProviderì—ì„œ í† í°ì„ ê²€ì¦
5. í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ ê²½ìš°
   5-1. JwtProviderì—ì„œ ìƒˆ í† í°ì„ ìƒì„±í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µ ì „ì†¡
6. í† í°ì´ ìœ íš¨í•˜ë©´, ì¸ì¦ ê°ì²´ë¥¼ SecurityContextHolderì— ì €ì¥


<br/><br/>

### 3. CONNECT ì´í›„, STOMP & Spring Messaging Broker
![2-1](https://github.com/user-attachments/assets/04bd1068-9112-4f39-b6f7-df48757d1c7b)

**1. Subscribe (Client)**
ClientëŠ” Connect ì´í›„ ë‘ ê°€ì§€ì˜ destinationì„ êµ¬ë…(Subscribe)í•œë‹¤. 
- `/sub/channel/roomId`: ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡ì„ ìˆ˜ì‹ í•˜ê¸° ìœ„í•¨
- `/sub/channel/entry`: ì‹¤ì‹œê°„ ì±„íŒ…ë°© ì…ì¥ ì¸ì›ì„ ìˆ˜ì‹ í•˜ê¸° ìœ„í•¨
- [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/905bcdfa9ae08d63ea3f131a71e9f77660d661d9/realTimeChat_Front-end/chat.js#L50C1-L65C6)

<br/>

**2. Send (Client)**
- ClientëŠ” `/pub/chat` ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì—¬ ì±„íŒ…ë°©ì— ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

<br/>

**3. Message (Server)** 
- ServerëŠ” Sessionì˜ Connectë¥¼ ê°ì§€í•˜ì—¬ `/sub/channel/entry`ì˜ êµ¬ë…ìë“¤ì—ê²Œ Session 'ì°¸ì—¬ì ìˆ˜'ë¥¼ send í•œë‹¤. [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/infra/handler/StompListener.java#L10C1-L35C2)
- Serverì˜ ë©”ì‹œì§€ ë¸Œë¡œì»¤ëŠ” `/sub/channel/roomId`ì˜ êµ¬ë…ìë“¤ì—ê²Œ ì‹¤ì‹œê°„ ì±„íŒ… ë©”ì‹œì§€ë¥¼ send í•œë‹¤. [(ì½”ë“œ ë§í¬)](https://github.com/wonseokLee97/realTimeChat/blob/fa5a668bd7ea3cca643b5f16cfa26272eae377a9/realTimeChat_Back-end/src/main/java/com/dev/realtimechat/presentation/ChatWebSocketController.java)






<br/><br/>


## ì£¼ìš” ì„±ê³¼ ë° ë°°ìš´ ì 




## ì¶”í›„ ê³ ë„í™” 
1. ì›ê²© ìºì‹œ ê¸°ë°˜ DB Connection Resource ì ˆê°
2. 

... í›„ìˆ ì˜ˆì •
